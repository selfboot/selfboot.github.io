<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="baidu-site-verification" content="codeva-WUJTOV7jES"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="This article analyzes the source code of OpenAI's open-source ChatGPT Python SDK library, introducing the design written using Python's advanced features, as well as the recent practice of introducing stainless for automatic SDK code generation. It briefly analyzes the OpenAPI specification and explains how to automatically generate SDKs based on interface definitions, providing a good reference for writing high-quality, user-friendly API client code."><title>Learning to Write a Python SDK Library for ChatGPT API from OpenAI</title><link rel="stylesheet" type="text/css" href="/css/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script type="text/javascript" src="/js/jquery.min.js"></script><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml,en/atom.xml"><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;973c5bad683a49b8af76df256779f523&quot;}"></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="referrer" content="no-referrer-when-downgrade"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QNFB9JLSPV"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QNFB9JLSPV');
</script><script async="" type="text/javascript" src="/js/clipboard.min.js"></script><script async="" type="text/javascript" src="/js/toastr.min.js"></script><link rel="stylesheet" href="/css/toastr.min.css"><script>function switchLanguage(lang) {
  var currentPath = window.location.pathname;
  var newPath;
  if (lang === 'en') {
    newPath = '/en' + currentPath.replace(/^\/(zh-CN\/)?/, '/');
  } else {
    newPath = currentPath.replace(/^\/en/, '');
  }
  window.location.href = newPath;
}</script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Learning to Write a Python SDK Library for ChatGPT API from OpenAI</h1><a id="logo" href="/.">Just For Fun</a><div class="lang-select-wrapper"><i class="fas fa-globe"></i><select id="lang-select" onchange="switchLanguage(this.value)"><option value="zh-CN">中文</option><option value="en" selected="">English</option></select></div><p class="description">Know what it is, and know why it is so. The breadth of knowledge is a byproduct of its depth!</p></div><div id="nav-menu"><a href="/en/."><i class="fa fa-home"></i><span> Home</span></a><a href="/en/archives/"><i class="fa fa-archive"></i><span> Archive</span></a><a href="/en/aboutme.html"><i class="fa fa-user"></i><span> About</span></a><a href="/en/atom.xml"><i class="fa fa-rss"></i><span> RSS</span></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Learning to Write a Python SDK Library for ChatGPT API from OpenAI</h1><div class="post-meta">2024/01/09<span> | </span><span class="category"><a href="/categories/Programming/">Programming</a></span><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" data-disqus-identifier="en/2024/01/09/openai_python_sdk_learn/" href="/en/2024/01/09/openai_python_sdk_learn/#disqus_thread"></a><div class="post-content"><p>After ChatGPT was released, OpenAI open-sourced the Python library <a target="_blank" rel="noopener" href="https://github.com/openai/openai-python">openai-python</a> for model invocation. This library is very comprehensive, encapsulating the APIs published by OpenAI, and is also very simple to use.</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20230831_openai_python_source_summary.webp/webp" alt="OpenAI-python library encapsulation" srcset="https://slefboot-1251736664.file.myqcloud.com/20230831_openai_python_source_summary.webp/webp 1920w, https://slefboot-1251736664.file.myqcloud.com/20230831_openai_python_source_summary.webp/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20230831_openai_python_source_summary.webp/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20230831_openai_python_source_summary.webp/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="1920" height="1080"></p>
<p>The first version of this library implemented Python abstract classes and invocation methods for parameter encapsulation of various ChatGPT APIs, using the requests and aiohttp libraries to send synchronous or asynchronous HTTP requests. Overall, the external interface is good and easy to use. The overall source code implementation has good logical abstraction, using many advanced Python features, and the code is beautifully written, worth learning from. But essentially, this is still “<strong>API boy</strong>“ work, more of repetitive manual labor without much technical content.</p>
<p>So, in November 2023, OpenAI began introducing <a target="_blank" rel="noopener" href="https://www.stainlessapi.com/">Stainless</a>, eliminating the need to manually write SDK code. Each time, they only need to provide API protocol updates, and then code can be automatically generated, <span style="color: red">freeing them from repetitive manual labor</span>. Specifically, new code was introduced in <a target="_blank" rel="noopener" href="https://github.com/openai/openai-python/pull/677">Pull 677</a> and released as the official V1 version.</p>
<span id="more"></span>

<h2 id="Manually-Crafted-SDK"><a href="#Manually-Crafted-SDK" class="headerlink" title="Manually Crafted SDK"></a>Manually Crafted SDK</h2><p>The initial Python SDK can be called a <strong>manually crafted SDK</strong>, with all code written by hand and coupled with the API. The overall directory structure is as follows:</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_old_ver.png/webp" alt="Old code version of openai-python library" srcset="https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_old_ver.png/webp 3416w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_old_ver.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_old_ver.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_old_ver.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="3416" height="1576"></p>
<p>The overall structure of this version of the code is relatively clear. I used <a target="_blank" rel="noopener" href="https://pylint.readthedocs.io/en/latest/pyreverse.html">Pyreverse</a> and <a target="_blank" rel="noopener" href="https://graphviz.org/">graphviz</a> to generate a class diagram for the openapi-sdk. After removing some unimportant classes, the overall class dependency relationship is as follows:</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20230829_openai_python_source_classes_core.png/webp" alt="Core class diagram of openai python library" srcset="https://slefboot-1251736664.file.myqcloud.com/20230829_openai_python_source_classes_core.png/webp 3016w, https://slefboot-1251736664.file.myqcloud.com/20230829_openai_python_source_classes_core.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20230829_openai_python_source_classes_core.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20230829_openai_python_source_classes_core.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="3016" height="1345"></p>
<p>There is a basic class OpenAIObject, which defines some basic fields, such as api_key, api_version, etc. The ChatCompletion class we commonly use indirectly inherits from this class. There are also two classes, OpenAIError and APIRequestor, used for handling errors and sending HTTP requests respectively. OpenAI’s code uses quite a few advanced Python features. Here we’ll take the overload decorator as an example to look at in detail. Of course, if you’re not interested in Python, you can skip this part and <strong>go directly to the automated generation section</strong>.</p>
<h3 id="overload-Decorator"><a href="#overload-Decorator" class="headerlink" title="overload Decorator"></a>overload Decorator</h3><p>The APIRequestor class in <a target="_blank" rel="noopener" href="https://github.com/openai/openai-python/blob/284c1799070c723c6a553337134148a7ab088dd8/openai/api_requestor.py#L221">openai-python/openai/api_requestor.py</a> has many methods decorated with overload, which is a new syntax introduced in Python 3.5, belonging to the <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/typing.html#typing.overload">typing package</a>.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">APIRequestor</span>:</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"><span class="meta">    @overload</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        method,</span></span><br><span class="line"><span class="params">        url,</span></span><br><span class="line"><span class="params">        params=...,</span></span><br><span class="line"><span class="params">        headers=...,</span></span><br><span class="line"><span class="params">        files=...,</span></span><br><span class="line"><span class="params">        *,</span></span><br><span class="line"><span class="params">        stream: <span class="type">Literal</span>[<span class="literal">True</span>],</span></span><br><span class="line"><span class="params">        request_id: <span class="type">Optional</span>[<span class="built_in">str</span>] = ...,</span></span><br><span class="line"><span class="params">        request_timeout: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="built_in">float</span>, <span class="type">Tuple</span>[<span class="built_in">float</span>, <span class="built_in">float</span>]]] = ...,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Tuple</span>[Iterator[OpenAIResponse], <span class="built_in">bool</span>, <span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">pass</span> </span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></tbody></table></figure>

<p>In Python, methods defined with the <code>@overload</code> decorator are <strong>only used for type checking and documentation, they are not actually executed</strong>. These overloads are mainly to provide more accurate type information, so that when using static type checkers (like mypy) or IDEs (like PyCharm), more accurate prompts and error checks can be obtained.</p>
<p>Using @overload can more accurately describe the behavior of a function or method <strong>under different parameter combinations</strong>. The actual implementation is in the request method without the <code>@overload</code> decorator. This method usually uses conditional statements (such as if, elif, else) or other logic to perform different operations based on different parameter combinations. The 4 request methods decorated with overload above actually define 4 different methods, each accepting different parameter combinations and returning different types of values.</p>
<p>Explanation of the request parameters above:</p>
<ul>
<li><code>files=...</code>: Here, files=… indicates that the files parameter is optional, but the type is not explicitly specified. In Python’s type hints, <code>...</code> (ellipsis) is usually used as a placeholder, meaning “there should be content here, but not yet specified”.</li>
<li><code>stream: Literal[True]</code>: Here, stream: <code>Literal[True]</code> indicates that the stream parameter must be the boolean value True. The Literal type is used to specify that a variable can only be a specific literal value, which is True here.</li>
<li><code>request_id: Optional[str] = ...</code>: Here, <code>Optional[str]</code> indicates that the request_id parameter can be of type str, or it can be None. Optional is usually used in type hints to indicate that a value can be of a certain type or None. The <code>= ...</code> here is also a placeholder, indicating that the default value has not been specified. In the actual method implementation, this would usually be replaced with an actual default value.</li>
</ul>
<p>Here’s a relatively simple example. Suppose we have a function add that can accept two integers or two strings, but cannot accept an integer and a string. Using @overload:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span>, overload</span><br><span class="line"></span><br><span class="line"><span class="meta">@overload</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="meta">@overload</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">str</span>, b: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>], b: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>]</span>) -&gt; <span class="type">Union</span>[<span class="built_in">int</span>, <span class="built_in">str</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(a, <span class="built_in">int</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(b, <span class="built_in">int</span>):</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(a, <span class="built_in">str</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(b, <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">"Invalid types"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>The benefits of adding annotations are:</p>
<ul>
<li>Type checking: After using <code>@overload</code>, if you try to pass an integer and a string to the add function, static type checkers will immediately report an error, without waiting until runtime.</li>
<li>Code readability: By looking at the <code>@overload</code> definitions, other developers can more easily understand what types of parameters the add function accepts, and the return types in different situations.</li>
<li>IDE support: In IDEs like <code>PyCharm</code>, <code>@overload</code> can provide more accurate auto-completion and parameter hints.</li>
<li>Documentation: <code>@overload</code> can also serve as documentation, explaining the different uses of functions or methods.</li>
</ul>
<p>For the <code>add</code> function above, if you call it like this: print(add(1, “2”)), mypy can detect the error without waiting until runtime:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">override.py:22: error: No overload variant of "add" matches argument types "int", "str"  [call-overload]</span><br><span class="line">override.py:22: note: Possible overload variants:</span><br><span class="line">override.py:22: note:     def add(a: int, b: int) -&gt; int</span><br><span class="line">override.py:22: note:     def add(a: str, b: str) -&gt; str</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Introducing-stainless-for-Library-Refactoring"><a href="#Introducing-stainless-for-Library-Refactoring" class="headerlink" title="Introducing stainless for Library Refactoring"></a>Introducing stainless for Library Refactoring</h2><p>The above is a more traditional way of generating Client code based on API interface definitions. In fact, the daily work of many programmers is similar to this, providing various parameters for APIs and then calling them, or providing interfaces externally, which is the so-called API boy.</p>
<p>OpenAI’s programmers, obviously not satisfied with being API boys, made a significant change in V1 in 2023.11, as can be seen from the repository’s commit history. They started using stainless to generate code, and subsequently introduced the <code>stainless-bot</code> robot.</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_stainless_bot.png/webp" alt="Starting to introduce the stainless-bot robot" srcset="https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_stainless_bot.png/webp 2940w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_stainless_bot.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_stainless_bot.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_stainless_bot.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2940" height="1448"></p>
<p><a target="_blank" rel="noopener" href="https://www.stainlessapi.com/">stainless</a> is an open-source API SDK generation tool that can automatically generate corresponding code based on API protocol definitions. You only need to provide the API interface file, which is the <a target="_blank" rel="noopener" href="https://www.openapis.org/">OpenAPI Specification</a> file, and then it will generate SDKs for various languages. Currently (as of 2024.01), it supports languages such as TypeScript, Node, Python, Java, Go, Kotlin, etc.</p>
<p>The <strong>quality of the generated code is also guaranteed</strong>. According to the documentation, it tries to make the automatically generated code as good as code written by <strong>expert-level programmers</strong>. The generated library also supports rich <strong>type checking</strong>, which can be used for auto-completion and documentation prompts when hovering over code in IDEs. It also <strong>supports automatic retries with backoff</strong>, as well as authentication. Every time there’s a new change in the API interface, you only need to update the API protocol definition file, then push it to stainless using Github Action, and it will automatically generate new code and provide a Pull Request for your repository.</p>
<p>It sounds great - you only need to change the protocol, and then you have generated code. The entire process doesn’t require people to write code, and there’s no repetitive manual labor. Let’s take a look at the recent commit records of OpenAI’s SDK. Basically, all the code is now committed by stainless-bot.</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_bot_commit.png/webp" alt="stainless-bot robot becomes the main code contributor" srcset="https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_bot_commit.png/webp 2868w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_bot_commit.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_bot_commit.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240108_openai_python_sdk_learn_bot_commit.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2868" height="1484"></p>
<p>There’s still a question here. The stainless-bot update <a target="_blank" rel="noopener" href="https://github.com/openai/openai-python/pull/829/files">feat(client): support reading the base url from an env variable</a> supports reading OPENAI_BASE_URL from environment variables, but <strong>I didn’t see any related explanation in the API spec</strong>. I’m not sure how this update was generated by stainless-bot.</p>
<p>It’s also worth noting that this refactoring <strong>broke compatibility</strong>, changing the way the library is called, so old version calling code needs to be changed. OpenAI also provided a migration guide document <a target="_blank" rel="noopener" href="https://github.com/openai/openai-python/discussions/742">v1.0.0 Migration Guide</a>, and provided an automated migration script for one-click migration.</p>
<h2 id="OpenAPI-Specification"><a href="#OpenAPI-Specification" class="headerlink" title="OpenAPI Specification"></a>OpenAPI Specification</h2><p>According to stainless, the basis for automatically generating code is the OpenAPI description file. The specific protocol can be referred to in the documentation <a target="_blank" rel="noopener" href="https://spec.openapis.org/oas/latest.html">OpenAPI Specification</a>. <strong>OpenAPI is mainly used for designing, building, documenting, and using RESTful Web services</strong>. It provides a standardized method to describe RESTful interfaces, making it convenient for <strong>developers to define API request paths, parameters, responses, security, etc. in YAML or JSON format</strong>. With the description file, you can <strong>automatically generate human-readable documentation, create automated tests, including generating client SDKs</strong>, etc.</p>
<p>The API definition of OpenAI ChatGPT is also open source, in the Github repository <a target="_blank" rel="noopener" href="https://github.com/openai/openai-openapi">openai-openapi</a>. The API interface definition for version 2.0 can be seen <a target="_blank" rel="noopener" href="https://github.com/openai/openai-openapi/blob/3d9e0aeb21ec75aa616aa4c17ea54c369e344cd0/openapi.yaml">here</a>.</p>
<p>Let’s take the <code>/chat/completions</code> interface as an example to see what content needs to be defined for an interface. First is some metadata:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="comment"># <span class="doctag">Note:</span> When adding an endpoint, make sure you also add it in the `groups` section, in the end of this file,</span></span><br><span class="line">  <span class="comment"># under the appropriate group</span></span><br><span class="line">  <span class="string">/chat/completions:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">createChatCompletion</span></span><br><span class="line">      <span class="attr">tags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Chat</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">model</span> <span class="string">response</span> <span class="string">for</span> <span class="string">the</span> <span class="string">given</span> <span class="string">chat</span> <span class="string">conversation.</span></span><br></pre></td></tr></tbody></table></figure>

<p>Here, post indicates that this interface supports post requests, operationId is the unique identifier for this operation, tags categorizes this operation as “Chat”, and summary provides a brief description of this operation. Next are some key constraints on the request and response, which have relatively high readability. For example, requestBody defines the data needed for the request, required: true indicates that the request body is required, and content specifies the content type of the request body, which is application/json here. It should be noted that <strong>schema references</strong> a schema defined elsewhere in the document (CreateChatCompletionRequest) to describe the structure of the request body. The advantage of doing this is that the same schema can be referenced in multiple places, avoiding repeating the same content.</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">requestBody:</span></span><br><span class="line">  <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">content:</span></span><br><span class="line">    <span class="attr">application/json:</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/components/schemas/CreateChatCompletionRequest"</span></span><br><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">"200":</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">OK</span></span><br><span class="line">    <span class="attr">content:</span></span><br><span class="line">      <span class="attr">application/json:</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/components/schemas/CreateChatCompletionResponse"</span></span><br></pre></td></tr></tbody></table></figure>

<p>The definition of CreateChatCompletionRequest is later, as shown in the following image, which is also quite complex. It provides detailed descriptions of the type of each parameter in the request body, whether it’s required, whether it’s enum content, etc. The response to the request, responses, is similar, with the entire response package format specified by CreateChatCompletionResponse, which I won’t elaborate on here.</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240109_openai_python_sdk_learn_yaml_msg.png/webp" alt="Definition of OpenAI's CreateChatCompletionRequest" srcset="https://slefboot-1251736664.file.myqcloud.com/20240109_openai_python_sdk_learn_yaml_msg.png/webp 2718w, https://slefboot-1251736664.file.myqcloud.com/20240109_openai_python_sdk_learn_yaml_msg.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240109_openai_python_sdk_learn_yaml_msg.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240109_openai_python_sdk_learn_yaml_msg.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2718" height="1820"></p>
<p>Next is the custom extended metadata <code>x-oaiMeta</code> section. name, group, returns, path provide additional information about the operation, and examples provide request and response examples for different scenarios, including code examples using cURL, Python, and Node.js, as well as corresponding response body examples. By providing specific usage examples, the API documentation becomes more understandable and usable.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Currently, stainless should still be in the beta stage, with only a few companies like OpenAI and Lithic using it, and there’s no detailed external documentation. Moreover, from the current pricing standards, it costs $250/month, which is a bit expensive for small developers. However, if it becomes mature enough in the future, it’s worth considering introducing stainless to generate code. This way, there’s no need for manual coding, and there’s less concern about code quality issues.</p>
<p>It has to be said that OpenAI is indeed a leader in AI. From this automated process of SDK code generation, we can also feel the continuous optimization of coding. As AI continues to mature, it’s believed that AI will participate more and more in coding, helping to generate more and more code.</p>
</div><div class="article-footer-copyright"><p> Written in Chinese, LLM translated into English</p><p>Non-commercial reproduction is allowed with proper attribution to the author and source. </p><p>For commercial reproduction, please contact the <a href="mailto:xuezaigds@gmail.com">author</a></p></div><div class="post-donate"><div class="donate_bar center" id="donate_board"><a class="btn_donate" id="btn_donate" href="javascript:;" title="Sponsor"></a><div class="donate_txt"> ↑<br>Good content, Sponsor it<br></div></div><div class="donate_bar center hidden" id="donate_guide"><img src="https://slefboot-1251736664.file.myqcloud.com/weixin.jpg" title="WeChat Sponsor"><img src="https://slefboot-1251736664.file.myqcloud.com/zhifubao.jpg" title="Alipay Sponsor"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><div class="addthis_sharing_toolbox"></div><div class="tags"><a href="/tags/Python/"><i class="fa fa-tag"></i>Python</a><a href="/tags/ChatGPT/"><i class="fa fa-tag"></i>ChatGPT</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://selfboot.cn/en/2024/01/09/openai_python_sdk_learn/';
    this.page.identifier = 'en/2024/01/09/openai_python_sdk_learn/';
    this.page.title = 'Learning to Write a Python SDK Library for ChatGPT API from OpenAI';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//xuelangZF.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//xuelangZF.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://xuelangZF.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="https://www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://selfboot.cn"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"></i><span>Categories</span></div><ul><li><a href="/en/categories/Programming/">Programming</a> (18)</li><li><a href="/en/categories/Source-Code-Analysis/">Source Code Analysis</a> (10)</li><li><a href="/en/categories/Artificial-Intelligence/">Artificial Intelligence</a> (12)</li><li><a href="/en/categories/Discovery/">Discovery</a> (1)</li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"></i><span>Tags</span></div><div class="tagcloud"><a href="/en/tags/Python/" style="font-size: 15.00px;">Python</a> <a href="/en/tags/Google/" style="font-size: 15.00px;">Google</a> <a href="/en/tags/C/" style="font-size: 15.00px;">C++</a> <a href="/en/tags/ChatGPT/" style="font-size: 15.00px;">ChatGPT</a> <a href="/en/tags/Prompt/" style="font-size: 15.00px;">Prompt</a> <a href="/en/tags/Redis/" style="font-size: 15.00px;">Redis</a> <a href="/en/tags/Debug/" style="font-size: 15.00px;">Debug</a> <a href="/en/tags/eBPF/" style="font-size: 15.00px;">eBPF</a> <a href="/en/tags/Go/" style="font-size: 15.00px;">Go</a> <a href="/en/tags/Frontend/" style="font-size: 15.00px;">Frontend</a> <a href="/en/tags/Gemini/" style="font-size: 15.00px;">Gemini</a> <a href="/en/tags/SEO/" style="font-size: 15.00px;">SEO</a> <a href="/en/tags/LLM/" style="font-size: 15.00px;">LLM</a> <a href="/en/tags/Web/" style="font-size: 15.00px;">Web</a> <a href="/en/tags/LevelDB/" style="font-size: 15.00px;">LevelDB</a></div></div><!-- Debug: page.path = en/2024/01/09/openai_python_sdk_learn/ --><div class="widget"><div class="widget-title"><i class="fa fa-file-o"></i><span>Recent</span></div><ul><li><a href="/en/2024/09/05/claude35_prompt/" title="Claude3.5's System Prompts - No Apologies, Face Blind, Hallucinate...">Claude3.5's System Prompts - No Apologies, Face Blind, Hallucinate...</a></li><li><a href="/en/2024/08/29/leveldb_source_utils/" title="LevelDB Explained - Arena, Random, CRC32, and More.">LevelDB Explained - Arena, Random, CRC32, and More.</a></li><li><a href="/en/2024/08/14/leveldb_source_wal_log/" title="LevelDB Explained - How To Read and Write WAL Logs">LevelDB Explained - How To Read and Write WAL Logs</a></li><li><a href="/en/2024/08/13/leveldb_source_unstand_c++/" title="LevelDB Explained -  Understanding Advanced C++ Techniques">LevelDB Explained -  Understanding Advanced C++ Techniques</a></li><li><a href="/en/2024/08/08/leveldb_source_bloom_filter/" title="LevelDB Explained - Bloom Filter Implementation and Visualization">LevelDB Explained - Bloom Filter Implementation and Visualization</a></li><li><a href="/en/2024/08/06/leveldb_source_prepare/" title="LevelDB Explained - Preparing the Development Environment">LevelDB Explained - Preparing the Development Environment</a></li><li><a href="/en/2024/08/02/leveldb_source_env_posixfile/" title="LevelDB Explained - Posix File Operation Details">LevelDB Explained - Posix File Operation Details</a></li><li><a href="/en/2024/07/22/leveldb_source_nodestructor/" title="LevelDB Explained - Preventing C++ Object Destruction">LevelDB Explained - Preventing C++ Object Destruction</a></li><li><a href="/en/2024/06/22/claude35_artifacts/" title="Creating Games Using Free Claude3.5 with Artifacts">Creating Games Using Free Claude3.5 with Artifacts</a></li><li><a href="/en/2024/06/13/async_pool_block_problem/" title="How an Async Thread Pool Exception Caused Service Chaos">How an Async Thread Pool Exception Caused Service Chaos</a></li></ul></div><!-- Debug: Current Language = en, Filtered Posts Count = 10 --><div class="widget" id="toc"><div class="widget-title"><i class="fa fa-list-ul"></i><span> Contents</span></div><ul class="dsq-widget-list"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Manually-Crafted-SDK"><span class="toc-number">1.</span> <span class="toc-text">Manually Crafted SDK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#overload-Decorator"><span class="toc-number">1.1.</span> <span class="toc-text">overload Decorator</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Introducing-stainless-for-Library-Refactoring"><span class="toc-number">2.</span> <span class="toc-text">Introducing stainless for Library Refactoring</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenAPI-Specification"><span class="toc-number">3.</span> <span class="toc-text">OpenAPI Specification</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusion"><span class="toc-number">4.</span> <span class="toc-text">Conclusion</span></a></li></ol></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Just For Fun.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/selfboot/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/selfboot"> SelfBoot.</a><p><span id="busuanzi_container_site_pv"></span>Total Site Visits:  <span id="busuanzi_value_site_pv"></span> Times，<span id="busuanzi_container_site_uv"></span>Unique Visitors:  <span id="busuanzi_value_site_uv"></span> People</p></div></div></div><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="stylesheet" type="text/css" href="/css/copyright.css"><a class="show" id="rocket" href="#top" aria-label="Back to top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script><script type="text/javascript" src="/js/jquery.fancybox.min.js" defer=""></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" defer=""></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.min.css"><script type="text/javascript" src="/js/toc.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>