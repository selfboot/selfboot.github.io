<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="baidu-site-verification" content="codeva-NxrUEx2EFN"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="This article documents the process of a backend developer developing a browser Tampermonkey script from scratch under ChatGPT's guidance. It covers the working principles of Tampermonkey scripts, debugging frontend styles, capturing DOM changes, adding interactions, and other techniques. It successfully implemented the function of capturing Latex mathematical formula text on the ChatGPT page. It shares the unique experience of using ChatGPT to learn new skills and enhance problem-solving abilities."><title>ChatGPT Teacher Teaches Me Writing a Tampermonkey Script</title><link rel="stylesheet" type="text/css" href="/css/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script type="text/javascript" src="/js/jquery.min.js"></script><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml,en/atom.xml"><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;973c5bad683a49b8af76df256779f523&quot;}"></script>
<script defer="" src="https://cloud.umami.is/script.js" data-website-id="3578d9f2-9ea0-49d4-8781-e8d1217ab924"></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="referrer" content="no-referrer-when-downgrade"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QNFB9JLSPV"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QNFB9JLSPV');
</script><script async="" type="text/javascript" src="/js/clipboard.min.js"></script><script async="" type="text/javascript" src="/js/toastr.min.js"></script><link rel="stylesheet" href="/css/toastr.min.css"><script>function switchLanguage(lang) {
  var currentPath = window.location.pathname;
  var newPath;
  if (lang === 'en') {
    newPath = '/en' + currentPath.replace(/^\/(zh-CN\/)?/, '/');
  } else {
    newPath = currentPath.replace(/^\/en/, '');
  }
  window.location.href = newPath;
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><a id="logo" href="/.">Just For Fun</a><div class="lang-select-wrapper"><i class="fas fa-globe"></i><select id="lang-select" onchange="switchLanguage(this.value)"><option value="zh-CN">中文</option><option value="en" selected="">English</option></select></div><p class="description">Know what it is, and know why it is so. The breadth of knowledge is a byproduct of its depth!</p></div><div id="nav-menu"><a href="/en/."><i class="fa fa-home"></i><span> Home</span></a><a href="/en/archives/"><i class="fa fa-archive"></i><span> Archive</span></a><a href="/en/aboutme.html"><i class="fa fa-user"></i><span> About</span></a><a href="/en/atom.xml"><i class="fa fa-rss"></i><span> RSS</span></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ChatGPT Teacher Teaches Me Writing a Tampermonkey Script</h1><div class="post-meta">2023/09/15<span> | </span><span class="category"><a href="/categories/Programming/">Programming</a></span><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" data-disqus-identifier="en/2023/09/15/chatgpt_export_script/" href="/en/2023/09/15/chatgpt_export_script/#disqus_thread"></a><div class="post-content"><p>Learning frontend with ChatGPT as a teacher? Sounds a bit incredible, after all, frontend has a lot to do with UI, and communicating frontend with ChatGPT, which doesn’t have <strong>multimodal capabilities</strong>, seems difficult just thinking about it. However, recently, with the help of ChatGPT, I quickly wrote a <a target="_blank" rel="noopener" href="https://greasyfork.org/en/scripts/475169-chatgpt-export">Tampermonkey plugin</a> that can copy the Latex text of mathematical formulas on ChatGPT’s chat interface.</p>
<p>As a backend developer with zero frontend experience, writing a Tampermonkey plugin would first require finding documentation and spending a lot of time just to write a prototype without ChatGPT. If problems were encountered in the middle, one would have to find answers on their own, which could be a very long process and might lead to giving up halfway. But with ChatGPT as a teacher, you can directly ask questions when encountering problems, making the entire development experience so much better.</p>
<p>Once again, I marvel at how ChatGPT really <strong>greatly expands personal technical capabilities and greatly improves personal problem-solving abilities!</strong></p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_copy.png/webp" alt="ChatGPT export plugin" srcset="https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_copy.png/webp 1764w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_copy.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_copy.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_copy.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="1764" height="1248"></p>
<span id="more"></span>

<h2 id="Tampermonkey-Script-Background"><a href="#Tampermonkey-Script-Background" class="headerlink" title="Tampermonkey Script Background"></a>Tampermonkey Script Background</h2><p>Recently, a book I was reading mentioned <strong>vector inner product</strong>, so I delved deeper into this <a href="https://selfboot.cn/2023/09/14/chatgpt_math_product/">mathematical knowledge</a> on ChatGPT. Then I wanted to copy the formulas from the chat page to my markdown notes, but found that directly copying the content wasn’t feasible.</p>
<p>Opening the browser’s developer tools, I saw that the html actually contained the Latex text representation of the formula, which could be viewed after copying and converting on <a target="_blank" rel="noopener" href="https://www.mathjax.org/#demo">mathjax</a>:</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_mathjax.png/webp" alt="Online preview of mathematical formulas" srcset="https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_mathjax.png/webp 2470w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_mathjax.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_mathjax.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_mathjax.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2470" height="1602"></p>
<p>However, we can’t open the developer tools every time we want to copy a formula. So I thought about writing a Tampermonkey script that could place a copy button next to the formula, which when clicked would copy the Latex formula.</p>
<h2 id="The-First-Version"><a href="#The-First-Version" class="headerlink" title="The First Version"></a>The First Version</h2><p>I hadn’t worked with Tampermonkey scripts before, but I wasn’t worried. I directly asked ChatGPT teacher:</p>
<blockquote>
<p>I want to write a Tampermonkey script that provides a copy button on the right side of formulas on the chat.openai.com page, to copy the text content of the formula. For example, the following html:<br>…<br>…<br>Copy the content inside annotation encoding=”application/x-tex”</p>
</blockquote>
<p>Soon, a simple prototype script came out, but after installing the script, I didn’t see the copy button. So I asked ChatGPT teacher again, and it told me that for dynamically loaded content, the <code>window.load</code> event that the above script relies on might not work completely. Because when window.load is triggered, these dynamic elements may not have loaded yet. In this case, a more reliable method is to use <code>MutationObserver</code> to listen for DOM changes. When new <strong>.math</strong> elements are added to the DOM, MutationObserver will trigger, and then you can add copy buttons accordingly.</p>
<p>Then it gave new script logic, defining an addCopyButtons function that performs the same task as before: finding all .math elements and adding copy buttons. Then, use MutationObserver to watch for all newly added or removed nodes on the page. Whenever the DOM changes, the addCopyButtons function will be called, ensuring that all new .math elements also get copy buttons.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Initial adding</span></span><br><span class="line"><span class="title function_">addCopyButtons</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Observe for new formulas</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"DOM has changed, rechecking..."</span>);</span><br><span class="line">  <span class="title function_">addCopyButtons</span>();</span><br><span class="line">});</span><br><span class="line">observer.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="property">body</span>, { <span class="attr">childList</span>: <span class="literal">true</span>, <span class="attr">subtree</span>: <span class="literal">true</span> });</span><br></pre></td></tr></tbody></table></figure>

<p>With this script, <strong>the page froze immediately upon opening</strong>, it seems the script has some form of infinite loop or excessive resource consumption. Then I directly gave all the current code to ChatGPT and asked it to help troubleshoot the reason for freezing. It found 3 places that might cause performance issues:</p>
<ol>
<li>MutationObserver triggers too frequently: If the page’s DOM changes frequently, MutationObserver might trigger many times, causing the addCopyButtons function to be called frequently as well.</li>
<li>Complex DOM queries: document.querySelectorAll and div.querySelector might become relatively slow in complex DOM structures.</li>
<li>Event listener accumulation: Every time addCopyButtons is called, you add a click event listener to the newly created button. If this function is called multiple times, the same element might bind multiple identical event listeners.</li>
</ol>
<p>Then it modified the above script, adding a simple debounce mechanism to limit the frequency of MutationObserver triggers, and avoiding adding the same event listener repeatedly. The main modifications are as follows:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">addCopyButtons</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">      <span class="keyword">const</span> mathDivs = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">'.math, .math-inline, .math-display'</span>);</span><br><span class="line">        mathDivs.<span class="title function_">forEach</span>(<span class="function"><span class="params">div</span> =&gt;</span> {</span><br><span class="line">          <span class="keyword">if</span> (div.<span class="title function_">getAttribute</span>(<span class="string">'data-copy-button-added'</span>) === <span class="string">'true'</span>) <span class="keyword">return</span>;</span><br><span class="line">          div.<span class="title function_">setAttribute</span>(<span class="string">'data-copy-button-added'</span>, <span class="string">'true'</span>);</span><br><span class="line">          ...</span><br><span class="line">      }</span><br><span class="line">    ...</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">debounceAddCopyButtons</span> = (<span class="params"></span>) =&gt; {</span><br><span class="line">        <span class="built_in">clearTimeout</span>(debounceTimer);</span><br><span class="line">        debounceTimer = <span class="built_in">setTimeout</span>(addCopyButtons, <span class="number">300</span>);</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="title function_">addCopyButtons</span>();  <span class="comment">// Run once initially</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"DOM has changed, rechecking..."</span>);</span><br><span class="line">        <span class="title function_">debounceAddCopyButtons</span>();</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    observer.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="property">body</span>, { <span class="attr">childList</span>: <span class="literal">true</span>, <span class="attr">subtree</span>: <span class="literal">true</span> });</span><br><span class="line">})();    </span><br></pre></td></tr></tbody></table></figure>

<p>At this point, the plugin basically works, but the style of the copy button is different from ChatGPT’s built-in copy button, and there’s no prompt after successful copying. To pursue perfection, we continue to optimize here.</p>
<h2 id="Replicating-Frontend-Styles"><a href="#Replicating-Frontend-Styles" class="headerlink" title="Replicating Frontend Styles"></a>Replicating Frontend Styles</h2><p>For a backend developer with zero frontend experience, I had no idea how to adjust these CSS styles. Here I wanted the copy button after each formula to be completely consistent with ChatGPT’s own copy button. In the browser’s developer tools, I directly copied over the SVG tag of the icon:</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">stroke</span>=<span class="string">"currentColor"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">stroke-width</span>=<span class="string">"2"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 24 24"</span> <span class="attr">stroke-linecap</span>=<span class="string">"round"</span></span></span><br><span class="line"><span class="tag"><span class="attr">stroke-linejoin</span>=<span class="string">"round"</span> <span class="attr">class</span>=<span class="string">"icon-sm"</span> <span class="attr">height</span>=<span class="string">"1em"</span> <span class="attr">width</span>=<span class="string">"1em"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"8"</span> <span class="attr">y</span>=<span class="string">"2"</span> <span class="attr">width</span>=<span class="string">"8"</span> <span class="attr">height</span>=<span class="string">"4"</span> <span class="attr">rx</span>=<span class="string">"1"</span> <span class="attr">ry</span>=<span class="string">"1"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>I found that there was indeed an icon, but <strong>the style wasn’t quite right, the color and mouse hover effect weren’t there</strong>, not to mention the color adaptation in dark mode. I had learned from GPT before that styles are usually set through the class of the tag, and I just happened to see that there was a button outside the svg tag with many classes, so I copied over this button and its classes as well, and the styles were basically consistent.</p>
<p>To understand what styles each class is responsible for, I used to remove them in the developer tools and compare the effects, but with ChatGPT, I could just ask it directly:</p>
<blockquote>
<p>Can you explain what styles each class is responsible for here:<br>class=”flex ml-auto gap-2 rounded-md p-1 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200 disabled:dark:hover:text-gray-400”</p>
</blockquote>
<p>So I learned the following explanation, these are class names from <code>Tailwind CSS</code>, each corresponding to a specific style:</p>
<ul>
<li>flex: Makes the element use Flexbox layout.</li>
<li>ml-auto: Sets the left margin (margin-left) to auto, typically used to push an element to the right of its container.</li>
<li>gap-2: Sets the gap between elements in a Flex or Grid layout.</li>
<li>rounded-md: Sets the element’s corners to medium-sized rounded corners.</li>
<li>p-1: Sets the element’s padding.</li>
</ul>
<p>Hover state</p>
<ul>
<li>hover:bg-gray-100: When the mouse hovers over the element, sets the background color to light gray.</li>
<li>hover:text-gray-700: When the mouse hovers over the element, sets the text color to dark gray.</li>
</ul>
<p>Dark mode</p>
<ul>
<li>dark:text-gray-400: In dark mode, sets the text color to medium gray.</li>
<li>dark:hover:bg-gray-700: In dark mode, when hovering, sets the background color to a deeper gray.</li>
<li>dark:hover:text-gray-200: In dark mode, when hovering, sets the text color to light gray.</li>
</ul>
<p>Dark mode + Disabled state</p>
<ul>
<li>disabled:dark:hover:text-gray-400: In dark mode, if the element is disabled, sets the text color to medium gray when hovering.</li>
</ul>
<p>Each of these class names is responsible for a very small but specific style setting, which is how Tailwind CSS works. By combining these class names, you can very flexibly build complex styles. With the above settings, the copy button is now consistent with the native one. <strong>The only imperfection is that when you click the native copy button, the icon changes to a check mark and then changes back, which the script can’t do yet</strong>.</p>
<h2 id="Capturing-Dynamic-Content"><a href="#Capturing-Dynamic-Content" class="headerlink" title="Capturing Dynamic Content"></a>Capturing Dynamic Content</h2><p>To pursue a perfect effect, I wanted to implement the same click effect in the Tampermonkey script. First, I needed to know what graphic ChatGPT’s successful copy checkmark prompt is. So I asked:</p>
<blockquote>
<p>There’s an svg button that changes to another svg when clicked, but it changes back very quickly. I want to see the svg it changes to in the middle, how can I do this?</p>
</blockquote>
<p>ChatGPT gave several approaches:</p>
<ol>
<li>When the SVG changes, the developer tools usually highlight the changed part, and you can quickly copy the SVG code at this time.</li>
<li>Use JavaScript in the console to pause the SVG change. If the SVG change is triggered by a function, you can rewrite that function to prevent it from performing its original task.</li>
<li>Find the JavaScript code that triggers the SVG change and set a breakpoint on the corresponding line. When the code executes to that line, it will pause, allowing you to view the SVG state at that time.</li>
<li>If the SVG is obtained through a network request, you can find the corresponding request in Network. Then you can see the SVG data in the “Response” section.</li>
</ol>
<p>The first few methods weren’t very feasible. For the first method, it changed back before I could copy it. For the 2nd and 3rd methods, I didn’t know how to find the JavaScript code that triggers the SVG change. The 4th method wasn’t applicable because no network request was triggered here.</p>
<p>Actually, the breakpoint method seemed most practical, because it’s difficult to find the part that triggers the SVG change by directly looking at the Script code. ChatGPT recommended using the “Event Listeners” feature of the browser’s developer tools to find the click event of this button. But when I looked at the Click event of the button element, the JS code found through the event wasn’t quite right either. Don’t panic, continue to ask ChatGPT teacher:</p>
<blockquote>
<p>I can’t find which event listener it is here, is there a more convenient method?</p>
</blockquote>
<p>ChatGPT recommended 3 more methods:</p>
<ol>
<li>Use JavaScript in the Console to manually add a click event to the button or svg here, outputting the content that changes after clicking the button.</li>
</ol>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">'.text-gray-400'</span>).<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="keyword">function</span>(<span class="params">e</span>) {</span><br><span class="line"><span class="keyword">if</span> (e.<span class="property">target</span>.<span class="title function_">closest</span>(<span class="string">'button'</span>)) {  <span class="comment">// Check if the click is on the button or its child elements</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {  <span class="comment">// Set a brief delay to capture possible changes</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="title function_">closest</span>(<span class="string">'.text-gray-400'</span>).<span class="property">innerHTML</span>);  <span class="comment">// Output the changed content</span></span><br><span class="line">    }, <span class="number">100</span>);  <span class="comment">// Delay 100 milliseconds, can be adjusted according to actual situation</span></span><br><span class="line">}</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>But after several attempts, there was no output here.</p>
<ol start="2">
<li><p>Find this svg element in the “Elements” panel. Right-click on this element, select “Break on” -&gt; “attribute modifications” from the menu that appears. This way, when the attributes of the element change, the code will automatically pause, giving you a chance to view or copy the current SVG code. Similarly, I tried Break on under several tags, but none of them paused at the right moment.</p>
</li>
<li><p>Use <code>MutationObserver</code>. This is a more advanced solution. Through the MutationObserver API, you can listen for DOM changes, including the addition and removal of elements.</p>
</li>
</ol>
<p>It was this third method that allowed me to successfully capture the changed icon content. The prompt here was also very simple, as follows:</p>
<blockquote>
<p>Here MutationObserver is used, can I directly output the changed small block when the page’s dom changes?</p>
</blockquote>
<p>So I got the following JS code (ChatGPT also thoughtfully provided comments):</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an observer instance and pass in a callback function</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">MutationObserver</span>(<span class="keyword">function</span>(<span class="params">mutations</span>) {</span><br><span class="line">  mutations.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">mutation</span>) {</span><br><span class="line">    <span class="comment">// Check if child nodes have been added or removed</span></span><br><span class="line">    <span class="keyword">if</span> (mutation.<span class="property">type</span> === <span class="string">'childList'</span>) {</span><br><span class="line">      <span class="comment">// If child nodes have been added</span></span><br><span class="line">      <span class="keyword">if</span> (mutation.<span class="property">addedNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) {</span><br><span class="line">        mutation.<span class="property">addedNodes</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">node</span>) {</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Added node:'</span>, node);</span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// If child nodes have been removed</span></span><br><span class="line">      <span class="keyword">if</span> (mutation.<span class="property">removedNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) {</span><br><span class="line">        mutation.<span class="property">removedNodes</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">node</span>) {</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Removed node:'</span>, node);</span><br><span class="line">        });</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// Check if attributes have changed</span></span><br><span class="line">    <span class="keyword">if</span> (mutation.<span class="property">type</span> === <span class="string">'attributes'</span>) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Attributes changed:'</span>, mutation.<span class="property">target</span>);</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// Configure observation options</span></span><br><span class="line"><span class="keyword">const</span> config = { <span class="attr">attributes</span>: <span class="literal">true</span>, <span class="attr">childList</span>: <span class="literal">true</span>, <span class="attr">subtree</span>: <span class="literal">true</span> };</span><br><span class="line"><span class="comment">// Start observing on the target node</span></span><br><span class="line">observer.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="property">body</span>, config);</span><br></pre></td></tr></tbody></table></figure>

<p>Copy and paste this code into the browser’s developer tools console to run, then click copy, and you can see the output content, as shown in the following image:</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_dom_change.png/webp" alt="Button changes observed in the console" srcset="https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_dom_change.png/webp 2828w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_dom_change.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_dom_change.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20230913_chatgpt_export_script_dom_change.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2828" height="766"></p>
<p>Here we can see that the HTML content of ChatGPT’s checkmark is as follows:</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"flex ml-auto gap-2 rounded-md p-1 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200 disabled:dark:hover:text-gray-400"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span></span></span><br><span class="line"><span class="tag">        <span class="attr">stroke</span>=<span class="string">"currentColor"</span> <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">stroke-width</span>=<span class="string">"2"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 24 24"</span> <span class="attr">stroke-linecap</span>=<span class="string">"round"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">stroke-linejoin</span>=<span class="string">"round"</span> <span class="attr">class</span>=<span class="string">"icon-sm"</span> <span class="attr">height</span>=<span class="string">"1em"</span> <span class="attr">width</span>=<span class="string">"1em"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">polyline</span> <span class="attr">points</span>=<span class="string">"20 6 9 17 4 12"</span>&gt;</span><span class="tag">&lt;/<span class="name">polyline</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>With this svg icon, it’s easy now. The rest is to replace the original icon with this one when clicked. First define this html as copiedButton, then ask ChatGPT to add the click event code.</p>
<h2 id="Setting-Copy-Action"><a href="#Setting-Copy-Action" class="headerlink" title="Setting Copy Action"></a>Setting Copy Action</h2><p>When asking questions here, it’s important to <strong>bring up the current version of the script</strong>, because this way it will make changes in the context of the current code. The prompt is as follows:</p>
<blockquote>
<p>I want to add an action to the following Tampermonkey script:</p>
<p>// ==UserScript==<br>// @name         chatgpt-export<br>…<br>…(omitted)<br>When copy is clicked, after successfully copying the formula, the copyButton here changes to copiedButton, and automatically reverts back after 2 seconds.</p>
</blockquote>
<p>ChatGPT provided a detailed method, suggesting that operations can be performed inside the click event listener, first changing the innerHTML of copyButton to copiedButton, then using setTimeout to change it back to copyButton after 2 seconds.</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...omit other code</span></span><br><span class="line">copyButton.<span class="title function_">addEventListener</span>(<span class="string">'click'</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">    navigator.<span class="property">clipboard</span>.<span class="title function_">writeText</span>(latexText).<span class="title function_">then</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'Copy successful!'</span>);</span><br><span class="line">        <span class="comment">// After successful copy, change the button to 'copiedButton'</span></span><br><span class="line">        copyButton.<span class="property">innerHTML</span> = copiedButton;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Revert the button after 2 seconds</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> {</span><br><span class="line">            copyButton.<span class="property">innerHTML</span> = copyButton;</span><br><span class="line">        }, <span class="number">2000</span>);</span><br><span class="line">    }).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'Copy failed:'</span>, err);</span><br><span class="line">    });</span><br><span class="line">});</span><br><span class="line"><span class="comment">// ...omit other code</span></span><br></pre></td></tr></tbody></table></figure>

<p>It also kindly <strong>pointed out a problem in my code</strong>: when creating copyButton, I used a <strong>local variable with the same name</strong> again. This would cause the original copyButton (the one storing the button HTML) to be overwritten. To avoid this problem, you should use different names for the copyButton variable used to store HTML and the copyButton variable used to create the actual DOM element.</p>
<p>However, <strong>I didn’t notice this problem</strong>, and after making the change, I found that the button was gone, replaced by [object HTMLSpanElement]. Asking ChatGPT again, I learned that copyButton is an HTMLSpanElement object, and setting it as its own innerHTML would cause it to become the string “[object HTMLSpanElement]”. The solution to this problem is to use different variable names to store HTML content and DOM elements. This way, you can reference them separately when needed. The key code is as follows:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> copyButtonHtml = <span class="string">`&lt;button **** &lt;/button&gt;`</span> <span class="comment">// Change the name here from copyButton to copyButtonHtml</span></span><br><span class="line"><span class="keyword">const</span> copyButton = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">'span'</span>);</span><br><span class="line">copyButton.<span class="property">innerHTML</span> = copyButtonHtml;</span><br></pre></td></tr></tbody></table></figure>

<p>With this, the copy functionality was complete. The last step was to publish the script. Not knowing the publishing process myself, I once again sought help from ChatGPT and uploaded the script to Greasy Fork. Finally, here’s the Tampermonkey script address: <a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/475169-chatgpt-export">chatgpt-export</a>.</p>
<p>After installing the script, in chat interfaces with mathematical formulas, there will be an additional copy button next to both inline formulas and block-level formulas. Clicking it allows you to copy the formula, and after copying, it briefly displays a checkmark. The overall effect is the same as the official native copy button.</p>
<h2 id="Unexpected-Ending"><a href="#Unexpected-Ending" class="headerlink" title="Unexpected Ending"></a>Unexpected Ending</h2><p>After publishing the plugin and experiencing it again, I suddenly discovered that the <strong>built-in copy function</strong> of the official version can export the markdown content of the current chat session, which also includes the latex text in the formulas, so this script is <strong>somewhat redundant</strong>. However, in this process, I still learned a lot of frontend knowledge and gained a deeper understanding of ChatGPT’s capabilities, which was still very worthwhile.</p>
<p>I also welcome everyone to try this script, after all, you can copy just one formula instead of the entire content~</p>
</div><div class="article-footer-copyright"><p> Written in Chinese, LLM translated into English</p><p>Non-commercial reproduction is allowed with proper attribution to the author and source. </p><p>For commercial reproduction, please contact the <a href="mailto:xuezaigds@gmail.com">author</a></p></div><div class="post-donate"><div class="donate_bar center" id="donate_board"><a class="btn_donate" id="btn_donate" href="javascript:;" title="Sponsor"></a><div class="donate_txt"> ↑<br>Good content, Sponsor it<br></div></div><div class="donate_bar center hidden" id="donate_guide"><img src="https://slefboot-1251736664.file.myqcloud.com/weixin.jpg" title="WeChat Sponsor"><img src="https://slefboot-1251736664.file.myqcloud.com/zhifubao.jpg" title="Alipay Sponsor"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><div class="addthis_sharing_toolbox"></div><div class="tags"><a href="/tags/ChatGPT/"><i class="fa fa-tag"></i>ChatGPT</a><a href="/tags/Frontend/"><i class="fa fa-tag"></i>Frontend</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://selfboot.cn/en/2023/09/15/chatgpt_export_script/';
    this.page.identifier = 'en/2023/09/15/chatgpt_export_script/';
    this.page.title = 'ChatGPT Teacher Teaches Me Writing a Tampermonkey Script';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//xuelangZF.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//xuelangZF.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://xuelangZF.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="https://www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://selfboot.cn"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"></i><span>Categories</span></div><ul><li><a href="/en/categories/Programming/">Programming</a> (18)</li><li><a href="/en/categories/Source-Code-Analysis/">Source Code Analysis</a> (15)</li><li><a href="/en/categories/Artificial-Intelligence/">Artificial Intelligence</a> (13)</li><li><a href="/en/categories/Discovery/">Discovery</a> (1)</li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"></i><span>Tags</span></div><div class="tagcloud"><a href="/en/tags/Python/" style="font-size: 15.00px;">Python</a> <a href="/en/tags/Google/" style="font-size: 15.00px;">Google</a> <a href="/en/tags/C/" style="font-size: 15.00px;">C++</a> <a href="/en/tags/ChatGPT/" style="font-size: 15.00px;">ChatGPT</a> <a href="/en/tags/Prompt/" style="font-size: 15.00px;">Prompt</a> <a href="/en/tags/Redis/" style="font-size: 15.00px;">Redis</a> <a href="/en/tags/Debug/" style="font-size: 15.00px;">Debug</a> <a href="/en/tags/eBPF/" style="font-size: 15.00px;">eBPF</a> <a href="/en/tags/Go/" style="font-size: 15.00px;">Go</a> <a href="/en/tags/Frontend/" style="font-size: 15.00px;">Frontend</a> <a href="/en/tags/Gemini/" style="font-size: 15.00px;">Gemini</a> <a href="/en/tags/SEO/" style="font-size: 15.00px;">SEO</a> <a href="/en/tags/LLM/" style="font-size: 15.00px;">LLM</a> <a href="/en/tags/Web/" style="font-size: 15.00px;">Web</a> <a href="/en/tags/LevelDB/" style="font-size: 15.00px;">LevelDB</a></div></div><!-- Debug: page.path = en/2023/09/15/chatgpt_export_script/ --><div class="widget"><div class="widget-title"><i class="fa fa-file-o"></i><span>Recent</span></div><ul><li><a href="/en/2025/01/02/leveldb_source_thread_anno/" title="LevelDB Explained - Static Thread Safety Analysis with Clang">LevelDB Explained - Static Thread Safety Analysis with Clang</a></li><li><a href="/en/2024/12/25/leveldb_source_hashtable/" title="LevelDB Explained - How to Design a High-Performance HashTable">LevelDB Explained - How to Design a High-Performance HashTable</a></li><li><a href="/en/2024/09/24/leveldb_source_skiplist_time_analysis/" title="LevelDB Explained - How to Analyze the Time Complexity of SkipLists?">LevelDB Explained - How to Analyze the Time Complexity of SkipLists?</a></li><li><a href="/en/2024/09/18/leveldb_source_skiplist_test/" title="LevelDB Explained - How to Test Parallel Read and Write of SkipLists?">LevelDB Explained - How to Test Parallel Read and Write of SkipLists?</a></li><li><a href="/en/2024/09/13/gpto1_hands_on/" title="Hands-on with OpenAI's o1-preview - Not Better Enough?">Hands-on with OpenAI's o1-preview - Not Better Enough?</a></li><li><a href="/en/2024/09/09/leveldb_source_skiplist/" title="LevelDB Explained - How to implement SkipList">LevelDB Explained - How to implement SkipList</a></li><li><a href="/en/2024/09/05/claude35_prompt/" title="Claude3.5's System Prompts - No Apologies, Face Blind, Hallucinate...">Claude3.5's System Prompts - No Apologies, Face Blind, Hallucinate...</a></li><li><a href="/en/2024/08/29/leveldb_source_utils/" title="LevelDB Explained - Arena, Random, CRC32, and More.">LevelDB Explained - Arena, Random, CRC32, and More.</a></li><li><a href="/en/2024/08/14/leveldb_source_wal_log/" title="LevelDB Explained - How To Read and Write WAL Logs">LevelDB Explained - How To Read and Write WAL Logs</a></li><li><a href="/en/2024/08/13/leveldb_source_unstand_c++/" title="LevelDB Explained -  Understanding Advanced C++ Techniques">LevelDB Explained -  Understanding Advanced C++ Techniques</a></li></ul></div><!-- Debug: Current Language = en, Filtered Posts Count = 10 --><div class="widget" id="toc"><div class="widget-title"><i class="fa fa-list-ul"></i><span> Contents</span></div><ul class="dsq-widget-list"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tampermonkey-Script-Background"><span class="toc-number">1.</span> <span class="toc-text">Tampermonkey Script Background</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-First-Version"><span class="toc-number">2.</span> <span class="toc-text">The First Version</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Replicating-Frontend-Styles"><span class="toc-number">3.</span> <span class="toc-text">Replicating Frontend Styles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Capturing-Dynamic-Content"><span class="toc-number">4.</span> <span class="toc-text">Capturing Dynamic Content</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setting-Copy-Action"><span class="toc-number">5.</span> <span class="toc-text">Setting Copy Action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unexpected-Ending"><span class="toc-number">6.</span> <span class="toc-text">Unexpected Ending</span></a></li></ol></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Just For Fun.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/selfboot/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/selfboot"> SelfBoot.</a><p><span id="busuanzi_container_site_pv"></span>Total Site Visits:  <span id="busuanzi_value_site_pv"></span> Times，<span id="busuanzi_container_site_uv"></span>Unique Visitors:  <span id="busuanzi_value_site_uv"></span> People</p></div></div></div><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="stylesheet" type="text/css" href="/css/copyright.css"><a class="show" id="rocket" href="#top" aria-label="Back to top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script><script type="text/javascript" src="/js/jquery.fancybox.min.js" defer=""></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" defer=""></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.min.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async=""></script><script type="text/javascript" src="/js/toc.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>