---
title: GPT4 帮忙写 sed, awk 数据处理命令
date: 2023-06-05 21:30:15
category: 工具介绍
tags: [GPT4]
toc: true
description: 在这篇博客中，我们将探索如何利用 AWK 和 SED 进行复杂的文本处理，同时展示了如何使用 OpenAI 的 GPT-4 模型来帮助我们编写命令和解决问题。我们将深入解析各种实际示例，包括如何过滤和排序数据，如何进行文本替换，以及如何删除或修改特定行。这篇文章不仅为你提供了深入理解 AWK 和 SED 的机会，还展示了人工智能如何帮助我们更有效地进行编程和数据处理。
---

AWK 和 SED 在处理文本数据时，无论是过滤、转换，还是操作，都展现出了无与伦比的效率和灵活性。但是工具的语法不是那么好记忆，有时候用起来还得去查看帮助文档。但是有了 GPT，直接描述具体想处理的任务内容，然后由 GPT 生成所需要的命令，十分方便。

![GPT 解决 Leetcode 算法题](https://slefboot-1251736664.cos.ap-beijing.myqcloud.com/20230605_gpt4_write_cmd.png)

<!--more-->

# awk 统计

**Human:**  
把下面脚本改对

```shell
cat data.txt  | grep '8:1' | awk '{print $7}' | awk -F ':' 'if($2>=1683993600 and $2<=1685808000) {print $0}'
```

> 这里每次写老是记不住语法，总要去看看文档才行。有了 GPT 就方便多了，直接让他纠错。这里甚至都不用给他背景，他能自动发现你的问题并修复的。

**ChatGPT:**  
你的脚本中的问题在于 `awk` 的 if 语句的语法不正确。awk 的 if 语句应该在 `{}` 内部，并且 if 语句后面应该直接跟条件，然后是动作。所以，你的脚本应该修改为：

```shell
cat data.txt | grep '8:1' | awk '{print $7}' | awk -F ':' '{if($2>=1683993600 && $2<=1685808000) print $0}'
```

这个脚本的意思是：

1. 从 data.txt 文件中读取数据。
2. 使用 grep 命令查找包含 '8:1' 的行。
3. 使用 awk 命令打印出每行的第7个字段。
4. 使用 awk 命令，以 : 为分隔符，如果第2个字段的值在 1683993600 和 1685808000 之间，则打印出整行。

---
**Human:**  
我想让上面的过滤脚本，在最后显示整行的内容，要怎么重新写 脚本

**ChatGPT:**  
如果你希望在最后显示整行的内容，你需要在第一次使用 awk 命令时就进行条件判断。这样你可以在满足条件时打印整行，而不仅仅是第7个字段。你可以这样修改你的脚本：

```shell
cat data.txt | grep '8:1' | awk -F ':' '{if($7>=1683993600 && $7<=1685808000) print $0}'
```

这个脚本的意思是：

1. 从 data.txt 文件中读取数据。
2. 使用 grep 命令查找包含 '8:1' 的行。
3. 使用 awk 命令，以 : 为分隔符，如果第7个字段的值在 1683993600 和 1685808000 之间，则打印出整行。

这样，你就可以在满足条件时看到整行的内容了。

---
**Human:**  
可以帮我再按照第 7 列的数据倒序排序吗

**ChatGPT:**  
当然可以，你可以使用 sort 命令对第7列的数据进行倒序排序。这里是修改后的脚本：

```shell
cat data.txt | grep '8:1' | awk -F ':' '{if($7>=1683993600 && $7<=1685808000) print $0}' | sort -t ':' -k7 -nr
```

这个脚本的意思是：

1. 从 data.txt 文件中读取数据。
2. 使用 grep 命令查找包含 '8:1' 的行。
3. 使用 awk 命令，以 : 为分隔符，如果第7个字段的值在 1683993600 和 1685808000 之间，则打印出整行。
4. 使用 sort 命令，以 : 为分隔符，对第7列进行倒序排序（-nr 表示数值排序并且是倒序）。

这样，你就可以看到满足条件的行，并且这些行是按照第7列的值进行倒序排序的。

---
**Human:**  
```shell
cat data.txt | grep '8:1' | awk -F ':' '{if($7>=1683993600 && $7<=1685808000) print $0}' | sort -t ':' -k7 -nr
```

我想改下上面的脚本，计算满足上面过滤条件的数据中，第 2 列数字的和

**ChatGPT:**  
如果你想计算满足过滤条件的数据中，第2列数字的和，你可以使用 awk 命令来实现。这里是修改后的脚本：

```shell
cat data.txt | grep '8:1' | awk -F ':' '{if($7>=1683993600 && $7<=1685808000) sum+=$2} END {print sum}'
```

这个脚本的意思是：

1. 从 data.txt 文件中读取数据。
2. 使用 grep 命令查找包含 '8:1' 的行。
3. 使用 awk 命令，以 : 为分隔符，如果第7个字段的值在 1683993600 和 1685808000 之间，则将第2个字段的值加到 sum 变量上。
4. 在所有行处理完毕后，打印出 sum 变量的值，即第2列数字的和。

这样，你就可以计算出满足条件的数据中，第2列数字的和了。

> 可以看到 GPT 使用 awk 是炉火纯青，基本手到擒来，很是方便。 

# sed 文本处理

**Human:**  
有一个很大的文本文件，我想删除中间的第 5 行，用什么命令可以完成呢

**ChatGPT:**  
如果你想删除一个文本文件中的特定行，你可以使用 `sed` 命令。sed 是一个流编辑器，可以用来对输入流（文件或管道）进行基于行的编辑。

如果你想删除第5行，你可以使用以下命令：

```shell
sed -i '5d' filename
```

这个命令的意思是：

1. -i：这个选项告诉 sed 对文件进行原地编辑，也就是说，修改会直接反映到文件上。
2. '5d'：这是 sed 的命令，表示删除第5行。
3. filename：这是你要编辑的文件的名称。

请注意，这个命令会直接修改文件，所以在运行之前，你可能需要备份你的文件。如果你不想直接修改文件，你可以去掉 `-i` 选项，这样 sed 会将修改的结果输出到标准输出，而不会改变原文件。

---
**Human:**  
我有一个文本文件，如下示例
Timestamp       Category        Message
1598843202      INFO    Booting up system
1598843402      INFO    Booting up critical service: Authorization
1598843502      INFO    System booted successfully

我想把里面的  INFO  改为  DEBUG，用什么命令来完成呢

**ChatGPT:**  
如果你想在一个文本文件中替换某个字符串，你可以使用 sed 命令。`sed` 是一个流编辑器，可以用来对输入流（文件或管道）进行基于行的编辑。

如果你想将所有的 "INFO" 替换为 "DEBUG"，你可以使用以下命令：

```shell
sed -i 's/INFO/DEBUG/g' filename
```

这个命令的意思是：

1. -i：这个选项告诉 sed 对文件进行原地编辑，也就是说，修改会直接反映到文件上。
2. 's/INFO/DEBUG/g'：这是 sed 的命令，表示将所有的 "INFO" 替换为 "DEBUG"。
3. filename：这是你要编辑的文件的名称。

请注意，这个命令会直接修改文件，所以在运行之前，你可能需要备份你的文件。如果你不想直接修改文件，你可以去掉 -i 选项，这样 sed 会将修改的结果输出到标准输出，而不会改变原文件。

---
**Human:**  
sed 还可以用来完成什么复杂的文本操作

**ChatGPT:**  

sed 是一个非常强大的文本处理工具，它可以用来执行各种复杂的文本操作。以下是一些 sed 可以完成的操作：

1. 查找和替换：这可能是 sed 最常见的用途。你可以使用 sed 来查找并替换文件中的文本，就像我们在上面的例子中所做的那样。
2. 删除行：你可以使用 sed 来删除文件中的特定行，或者删除匹配特定模式的行。
3. 插入和追加文本：你可以使用 sed 在文件的特定位置插入或追加文本。
4. 修改行：你可以使用 sed 修改文件中的特定行。
5. 打印特定行：你可以使用 sed 打印文件中的特定行。
6. 多点编辑：你可以在一个 sed 命令中执行多个编辑操作。
7. 正则表达式匹配：sed 支持正则表达式，这使得你可以执行复杂的文本匹配和操作。
8. 脚本化：你可以将一系列 sed 命令写入一个脚本文件中，然后使用 sed -f 命令来执行这个脚本。

这只是 sed 可以做的一些基本操作，实际上 sed 的功能远不止这些。如果你想深入了解 sed，我建议你查阅 sed 的手册或者其他相关的教程。