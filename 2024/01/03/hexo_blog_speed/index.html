<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="baidu-site-verification" content="codeva-WUJTOV7jES"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="本文详细介绍了个人博客访问速度优化的技术手段，包括CDN加速、WebP格式转换、响应式图片、HTTP/2协议等，并给出具体的代码实现和避坑指南。这些方法能明显提升页面加载速度，改善用户体验。文章还分析了效果评估指标，为搭建高性能博客提供了参考。"><title>个人博客访问速度优化：CDN, 图片压缩, HTTP2</title><link rel="stylesheet" type="text/css" href="/css/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><script type="text/javascript" src="/js/jquery.min.js"></script><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml,en/atom.xml"><script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;973c5bad683a49b8af76df256779f523&quot;}"></script>
<script defer="" src="https://cloud.umami.is/script.js" data-website-id="3578d9f2-9ea0-49d4-8781-e8d1217ab924"></script><script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><meta name="referrer" content="no-referrer-when-downgrade"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-QNFB9JLSPV"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QNFB9JLSPV');
</script><script async="" type="text/javascript" src="/js/clipboard.min.js"></script><script async="" type="text/javascript" src="/js/toastr.min.js"></script><link rel="stylesheet" href="/css/toastr.min.css"><script>function switchLanguage(lang) {
  var currentPath = window.location.pathname;
  var newPath;
  if (lang === 'en') {
    newPath = '/en' + currentPath.replace(/^\/(zh-CN\/)?/, '/');
  } else {
    newPath = currentPath.replace(/^\/en/, '');
  }
  window.location.href = newPath;
}</script><meta name="generator" content="Hexo 7.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><a id="logo" href="/.">Just For Fun</a><div class="lang-select-wrapper"><i class="fas fa-globe"></i><select id="lang-select" onchange="switchLanguage(this.value)"><option value="zh-CN" selected="">中文</option><option value="en">English</option></select></div><p class="description">知其然，知其所以然。知识广度是深度的副产品！</p></div><div id="nav-menu"><a href="/."><i class="fa fa-home"></i><span> 首页</span></a><a href="/archives/"><i class="fa fa-archive"></i><span> 归档</span></a><a href="/aboutme.html"><i class="fa fa-user"></i><span> 关于</span></a><a href="/links.html"><i class="fa fa-user-graduate"></i><span> 小盛律师</span></a><a href="/categories/%E6%B3%95%E5%BE%8B%E6%99%AE%E5%8F%8A/"><i class="fa fa-scale-balanced"></i><span> 法律普及</span></a><a href="/atom.xml"><i class="fa fa-rss"></i><span> 订阅</span></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">个人博客访问速度优化：CDN, 图片压缩, HTTP2</h1><div class="post-meta">2024/01/03<span> | </span><span class="category"><a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/">项目实践</a></span><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" data-disqus-identifier="2024/01/03/hexo_blog_speed/" href="/2024/01/03/hexo_blog_speed/#disqus_thread"></a><div class="post-content"><p>个人博客也写了有一段时间了，之前是能访问到就好，对速度没啥追求。前段时间，自己访问的时候，都感觉到页面加载速度比较慢，比较影响体验。此外加载慢的话，还会<strong>影响搜索引擎排名</strong>。于是动手对博客进行了系列的优化，提升了页面的加载速度。中间遇到了不少坑，本文记录下来，希望对大家有所帮助。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_insights.png/webp" alt="个人博客网页加载速度优化" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_insights.png/webp 2020w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_insights.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_insights.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_insights.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2020" height="1022"></p>
<span id="more"></span>

<p>先说下个人博客的整体架构，博客是基于 <a target="_blank" rel="noopener" href="https://hexo.io/index.html">Hexo</a> 搭建的。托管在 GitHub 上，每次增加新的 markdown 文章后，就会触发 Github Action 自动构建，生成静态文件。这里静态页面没有直接用 Github Pages 托管，而是用了 <a target="_blank" rel="noopener" href="https://app.netlify.com/">netlify</a>，因为 netlify 提供了免费的 CDN 加速，国内和国外访问延迟都还可以，并且部署也很简单。</p>
<h2 id="CDN-加速"><a href="#CDN-加速" class="headerlink" title="CDN 加速"></a>CDN 加速</h2><p>首先就是 CDN 加速，对于静态页面，这种方法最简单的、最有效的。博客里的 html 文件，直接用 netlify 自带的 CDN 加速，国内、外访问速度提升了很多。除了静态 html 文件，还有一些页面 css 和 js 资源，以及最耗带宽的图片资源。</p>
<h3 id="CSS-和-JS-文件"><a href="#CSS-和-JS-文件" class="headerlink" title="CSS 和 JS 文件"></a>CSS 和 JS 文件</h3><p>这里 js 和 css 我也是和博客静态文件一样，依赖 netlify CDN 加速。只要把这些静态文件全部放在博客的主题 css 和 js 目录下，然后在博客模板中引用即可。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">link(rel='stylesheet', type='text/css', href=url_for(theme.css) + '/normalize.min.css') </span><br><span class="line">link(rel='stylesheet', type='text/css', href=url_for(theme.css) + '/pure-min.min.css') </span><br><span class="line">link(rel='stylesheet', type='text/css', href=url_for(theme.css) + '/grids-responsive-min.css') </span><br><span class="line">script(type='text/javascript', src=url_for(theme.js) + '/jquery.min.js')</span><br></pre></td></tr></tbody></table></figure>

<p>这样的好处在于，解析我博客域名后，会把 html 文件和 js 这些一起从 CDN 加载。在 HTTP2 的情况下，这些文件可以并行加载，提升了加载速度。相比从其他 CDN 加载这些文件，少了 DNS 解析，理论上会更快些。</p>
<p>不过对于 <code>font-awesome</code>，因为它的 css 文件中引用了字体文件，直接放在主题的 css 目录下还需要很多字体文件，有点麻烦。这里就引用了 CDN 的资源，推荐用 <a target="_blank" rel="noopener" href="https://cdnjs.cloudflare.com/">cloudflare</a>，网络活菩萨的 CDN，速度还是很快的。并且各种静态库版本也很全，可以直接在网站上搜索，然后引用。</p>
<figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css')</span><br></pre></td></tr></tbody></table></figure>

<p>这里最开始放在 <a target="_blank" rel="noopener" href="https://www.bootcdn.cn/index.html">bootcdn</a> 的，用了一段时间后，发现图标加载不出来。看了下，应该是 cdn 上的<strong>图标字体文件损坏</strong>，但是一直也没修复，于是就弃用了。</p>
<h3 id="图片-CDN"><a href="#图片-CDN" class="headerlink" title="图片 CDN"></a>图片 CDN</h3><p>其实最影响页面加载速度的就是图片，优化的关键点就是图片。这里图片本来是存储在腾讯云 COS 上的，访问也是直接用 COS 链接。图片的优化有几个方面，这里先来看看 CDN 加速，至于图片压缩和自适应，下面展开。</p>
<p>以腾讯云 CDN 为例，要给 COS 存储开启 CDN 还是比较简单的，2022年5月9日前，支持默认 CDN 加速域名，只需要简单开启就行。不过现在的话，只能用自定义域名，如果做国内加速，<strong>域名还需要备案</strong>。配置起来很简单，基本设置好加速的域名，以及源站地址就行。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image.png/webp" alt="腾讯云 CDN 加速 COS 存储" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image.png/webp 2392w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2392" height="1730"></p>
<p>这里配置好 CDN 后，就可以通过腾讯云的<strong>实时监控</strong>，看到实时请求数据。包括带宽，请求量，流量命中率，请求数，请求结果状态码等信息。此外，通过<strong>数据分析</strong>，还能看到访问 Top 1000 URL，独立 IP 访问数，Top 100 Referer，<strong>访问用户区域分布</strong>等信息。</p>
<p>CDN 还有<strong>日志服务</strong>，可以提供每个小时的访问日志下载，里面有请求时间、客户端IP、访问域名、文件路径、字节数大小、省份、运营商、HTTP返回码、Referer、 request-time（毫秒）、UA、Range、HTTP Method、HTTP协议标识、缓存Hit/Miss等信息，可以用来做一些分析。</p>
<p>平常用的比较多的还有刷新预热，比如博客中的一个图片，已经缓存到了 CDN。但是我又改了下图，在 COS 中上传后，可以在这里刷新缓存，这样 CDN 缓存里的就是最新版本的图片了。</p>
<p>除了腾讯云的 CDN，还有各大云厂商的 CDN，国内的加速都需要域名备案，比较麻烦些。这里可以尝试 Cloudflare 的 R2 存储配合 CDN 加速，免费额度应该也够个人博客用了。</p>
<h3 id="CDN-防盗刷"><a href="#CDN-防盗刷" class="headerlink" title="CDN 防盗刷"></a>CDN 防盗刷</h3><p>博客图片放在 CDN 上之后，因为一个文章 <a target="_blank" rel="noopener" href="http://localhost:4000/2023/12/28/black_hat_SEO/">从外围引流贴看黑产的搜索引擎排名优化生意</a>，不知道得罪了什么人，于是被盗刷了图片的 CDN 流量，搞得我<strong>腾讯云都欠费</strong>了。这里先普及下，一般 CDN 是<strong>按照流量计费</strong>，腾讯云上境内 100GB 一般是 20 元。对于个人博客来说，流量一般很少的，这里的 CDN 费用基本可以忽略。但是如果被人盗刷流量，就会导致 CDN 费用暴涨。如果没有做一些防护，盗刷很简单，只用不断发请求来拉你的图片就行。</p>
<p>下图就是我 CDN 被盗刷的监控，在 2023 年 12 月 29，只用不到 3 个小时，就被刷了 200G 左右的流量，相当于近 40 元的费用。当然黑产估计还是手下留情了，不然很容易就刷的我破产了。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_theft.png/webp" alt="CDN 被盗刷，短时间产生大量流量" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_theft.png/webp 3268w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_theft.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_theft.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_theft.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="3268" height="1670"></p>
<p>当然，有一些常规的做法，可以来对抗 CDN 盗刷流量。腾讯云的 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/document/product/228/51813">攻击风险高额账单</a> 文档里面介绍的不错，主要有三类方法：</p>
<ol>
<li><strong>访问控制</strong>。这里有很多种，比如防盗链，主要防止别人的网站用到你的图片。IP 黑白名单配置，找到攻击者的 IP，全部加入黑名单，不过专业的黑产可能有很多 IP，封不过来。这时候再配一个 IP 频率限制，每个 IP 只给 10 QPS，这样能大幅度提升攻击者的对抗成本。</li>
<li><strong>流量管理</strong>。腾讯云 CDN 提供的一个兜底方案，比如 5 分钟内流量到 100 MB，或者每天流量到 10GB，就自动关 CDN，防止不小心产生高额账单。</li>
<li><strong>安全防护</strong>。需要付费购买，对于个人博客来说有点杀鸡用牛刀了，暂时没用到。</li>
</ol>
<p>这里对抗黑产的基本原则就是，<strong>在不影响正常用户体验的情况下，增加攻击者的成本。同时如果没有防住，尽量让损失可控</strong>。下面腾讯云我博客图片 CDN 的部分安全防护。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_protection.png/webp" alt="CDN 防盗刷简单配置" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_protection.png/webp 2950w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_protection.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_protection.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_traffic_protection.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2950" height="1778"></p>
<h2 id="图片优化"><a href="#图片优化" class="headerlink" title="图片优化"></a>图片优化</h2><p>在上了 CDN 后，用 <a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a> 测了下，发现图片加载比较耗时，优化方法主要有两个：</p>
<ol>
<li><strong>优化图片格式</strong>，用 WebP 格式。博客的图片之前都是 png 的，虽然上传 COS 前自动压缩了，但是还是比较大。WebP 是一个非常出色的现代图片格式，与 PNG 相比，WebP <strong>无损图片</strong>的尺寸缩小了 26%。</li>
<li><strong>自适应图片</strong>。就是根据屏幕大小，加载不同尺寸的图片，比如手机屏幕加载小图，电脑屏幕加载大图。这样可以减少加载的流量，提升加载速度。</li>
</ol>
<h3 id="图片格式优化"><a href="#图片格式优化" class="headerlink" title="图片格式优化"></a>图片格式优化</h3><p>这里最直观的方法就是，把博客所有存量的图片<strong>全部转换为 WebP 格式</strong>，重新上传 COS 后，替换博客文章里的图片链接。不过在看腾讯云的文档时，发现 COS 有<strong>图片处理</strong>功能，可以在图片链接后面，加上参数，来完成对图像的格式转换。比如我的图片地址是 <code>https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2.png</code>，只用在链接后面加上 <code>/webp</code>，就拿到了一个小的多的 WebP 图片。</p>
<p>整体配置也很简单，打开 COS bucket 的<strong>数据处理，图片处理</strong>，然后在<strong>图片处理样式</strong>里增加样式即可，上面的格式转换例子，样式描述就是 <code>imageMogr2/format/webp/interlace/1</code>。腾讯云用的万象图片处理，支持了不少处理，包括图片缩放，裁剪，旋转，格式转换，水印，高斯模糊等等。这里只用到了格式转换，其他的可以自己看下文档。</p>
<p>下图是我用到的几个转换，其中 webp 就是原图转换为 WebP 格式，然后 webp400 就是转换为宽度为 400 像素的图，用来在比较小的设备上显示。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_image_webp.png/webp" alt="腾讯云 COS 图片处理" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_image_webp.png/webp 3206w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_image_webp.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_image_webp.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_image_webp.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="3206" height="1354"></p>
<p>写博客过程中，图片链接还是正常的 png 链接就行，然后 hexo 构建静态文件使，用 JS 脚本来批量把文章里的图片链接加上样式。这里也踩了一个坑，生成的 webp 中，有部分图片链接返回 404，但是 COS 上文件是存在的。后来找了客服，辗转了好几次，才最终定位到问题，万象在解析 URL 的时候，decode 链接里的 + 号。然后客服通过他们自己的后台，给我的桶关闭了这个 decode 选项。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image_bug.png/webp" alt="腾讯云 COS 图片处理 Bug" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image_bug.png/webp 2046w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image_bug.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image_bug.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_cdn_image_bug.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2046" height="1456"></p>
<h3 id="自适应图片"><a href="#自适应图片" class="headerlink" title="自适应图片"></a>自适应图片</h3><p>在前面格式转换这里，提到我建了多个样式，对应不同大小的 WebP 图片。接下来要做的就是，根据设备像素大小，来决定具体加载哪个尺寸的图片。在处理前，先推荐一个工具，<a target="_blank" rel="noopener" href="https://ausi.github.io/respimagelint/">RespImageLint</a>，可以检查页面中的图片尺寸是否合理。</p>
<p>把这个工具加到浏览器标签后，访问博客中的文章页面，然后点击 <code>Lint Images</code> 标签，工具就会模拟各种尺寸的设备来访问页面，然后看浏览器请求的图片是否合理。最后会生成一个报告，列出每个图片的检查结果。如下图：</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_link_images.png/webp" alt="RespImageLint 检查自适应图片" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_link_images.png/webp 2372w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_link_images.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_link_images.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_link_images.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2372" height="1488"></p>
<p>当然这个是我用了自适应图片后的检查结果了，如果没有做自适应，就会有很多警告。这里自适应基本思路就是用万象为每张图片提供多个版本大小，然后通过媒体查询、视口尺寸属性等指定在不同像素设备下使用的图片版本。具体到我博客里，在 hexo 渲染 HTML 的时候，用 js 脚本来替换图片链接，增加 srcset，sizes 属性。</p>
<ul>
<li>设置 srcset 属性。srcset 属性用于指定图片的不同尺寸来源，允许浏览器根据设备屏幕的大小和分辨率选择合适的图片版本。</li>
<li>设置 sizes 属性。sizes 属性定义了图片在不同视口（viewport）宽度下应该使用的布局宽度，允许浏览器更准确地选择 srcset 中的合适图片。</li>
<li>更新图片属性，更新 img 标签的 src、width 和 height 属性，确保图片的适当渲染和比例。</li>
</ul>
<p>具体就是在 hexo 项目的根目录下创建 scripts 目录，然后创建 <code>img.js</code> 文件，内容如下：</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">"cheerio"</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> imageSize = <span class="built_in">require</span>(<span class="string">"image-size"</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">"after_render:html"</span>, <span class="keyword">function</span> (<span class="params">str, data</span>) {</span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.<span class="title function_">load</span>(str);</span><br><span class="line"></span><br><span class="line">  $(<span class="string">"img"</span>).<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params"></span>) {</span><br><span class="line">    <span class="keyword">const</span> img = $(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">const</span> src = img.<span class="title function_">attr</span>(<span class="string">"src"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      src &amp;&amp;</span><br><span class="line">      (src.<span class="title function_">endsWith</span>(<span class="string">".png"</span>) ||</span><br><span class="line">        src.<span class="title function_">endsWith</span>(<span class="string">".jpeg"</span>) ||</span><br><span class="line">        src.<span class="title function_">endsWith</span>(<span class="string">".jpg"</span>) ||</span><br><span class="line">        src.<span class="title function_">endsWith</span>(<span class="string">".gif"</span>) || </span><br><span class="line">        src.<span class="title function_">endsWith</span>(<span class="string">".webp"</span>))</span><br><span class="line">    ) {</span><br><span class="line">      <span class="keyword">const</span> parsedUrl = url.<span class="title function_">parse</span>(src);</span><br><span class="line">      <span class="keyword">const</span> imgPathPart = parsedUrl.<span class="property">path</span>;</span><br><span class="line">      <span class="keyword">const</span> imgPath = path.<span class="title function_">join</span>(__dirname, <span class="string">"../images"</span>, imgPathPart);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 检查文件是否存在</span></span><br><span class="line">      <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(imgPath)) {</span><br><span class="line">        <span class="keyword">const</span> dimensions = <span class="title function_">imageSize</span>(imgPath);</span><br><span class="line">        <span class="keyword">const</span> width = dimensions.<span class="property">width</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> small = src + <span class="string">"/webp400"</span>;</span><br><span class="line">        <span class="keyword">const</span> middle = src + <span class="string">"/webp800"</span>;</span><br><span class="line">        <span class="keyword">const</span> large = src + <span class="string">"/webp1600"</span>;</span><br><span class="line">        <span class="keyword">const</span> origin = src + <span class="string">"/webp"</span>;</span><br><span class="line">        <span class="keyword">let</span> srcset = <span class="string">`<span class="subst">${origin}</span> <span class="subst">${width}</span>w`</span>;</span><br><span class="line">        <span class="keyword">if</span> (width &gt; <span class="number">400</span>) srcset += <span class="string">`, <span class="subst">${small}</span> 400w`</span>;</span><br><span class="line">        <span class="keyword">if</span> (width &gt; <span class="number">800</span>) srcset += <span class="string">`, <span class="subst">${middle}</span> 800w`</span>;</span><br><span class="line">        <span class="keyword">if</span> (width &gt; <span class="number">1600</span>) srcset += <span class="string">`, <span class="subst">${large}</span> 1600w`</span>;</span><br><span class="line">        img.<span class="title function_">attr</span>(<span class="string">"srcset"</span>, srcset);</span><br><span class="line">        <span class="keyword">let</span> sizes;</span><br><span class="line">        <span class="keyword">if</span> (width &lt;= <span class="number">400</span>) {</span><br><span class="line">          sizes = <span class="string">`<span class="subst">${width}</span>px`</span>;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">          sizes=<span class="string">"(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)"</span></span><br><span class="line">        }</span><br><span class="line">        img.<span class="title function_">attr</span>(<span class="string">"sizes"</span>, sizes);</span><br><span class="line">        img.<span class="title function_">attr</span>(<span class="string">"src"</span>, origin);</span><br><span class="line">        <span class="keyword">const</span> height = dimensions.<span class="property">height</span>;</span><br><span class="line">        img.<span class="title function_">attr</span>(<span class="string">"width"</span>, width);</span><br><span class="line">        img.<span class="title function_">attr</span>(<span class="string">"height"</span>, height);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $.<span class="title function_">html</span>();</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>然后 hexo 渲染的时候就会调用这个脚本来对图片属性进行处理，渲染后的结果如下：</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render.png/webp" alt="自适应图片渲染后的结果" srcset="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render.png/webp 2270w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2270" height="1074"></p>
<p>接着可以在浏览器的开发者工具中，<strong>选择不同尺寸的屏幕大小</strong>，然后看请求 Network 选项卡中，浏览器具体选择的是哪个图片版本。如下图，在小尺寸下选择的 400 的图片，中尺寸就是 800 的图片。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render_choice.png/webp" alt="自适应图片渲染后在不同设备下的尺寸" srcset="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render_choice.png/webp 2802w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render_choice.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render_choice.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_image_render_choice.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2802" height="1760"></p>
<h2 id="HTTP-2"><a href="#HTTP-2" class="headerlink" title="HTTP 2"></a>HTTP 2</h2><p>最后一个优化就是，让博客中的请求尽量用 HTTP2 协议。HTTP2 做了很多优化，相比 HTTP1.1 有较大提升，可以很有效的提高网页加载速度。比如可以使用单个 TCP 连接来一次发送多个数据流，使得任何资源都不会会阻碍其他资源。博客静态资源托管在了 Netlify，默认支持 http2，但是里面图片和一些 js 脚本，有的并不支持 http2。在浏览器的控制台工具中，通过 network 选项卡，可以看到每个资源的 http2 支持情况。</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2.png/webp" alt="博客中各个资源的 HTTP2 支持情况" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2.png/webp 2856w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2856" height="1774"></p>
<p>接下来就是把 http 1.1 的请求，升级为 http2。最主要的其实是图片，因为图片其实是流量大头。这里图片放到 CDN 后，就可以开启 HTTP2 了，以腾讯云为例，如下：</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2_image.png/webp" alt="腾讯云 CDN HTTP2 配置" srcset="https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2_image.png/webp 2892w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2_image.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2_image.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240102_hexo_blog_speed_http2_image.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2892" height="1310"></p>
<p>解决图片后，剩下的只有 <strong>Disqus 评论系统</strong>和<strong>百度的统计脚本</strong>还是用的 http1.1 了。看了下 Disqus 的官网，没发现怎么开启 http2，不过考虑到这里评论系统是动态加载，不影响页面加载速度，就先不管了。百度的<a target="_blank" rel="noopener" href="https://tongji.baidu.com/web/help/article?id=174&amp;type=0">统计脚本</a> 也不支持 http2，不过考虑到流量没有多少来自百度，百度的统计也比较垃圾，这里就直接去掉百度统计了。目前接了 <a target="_blank" rel="noopener" href="https://analytics.google.com/analytics/web/">Google Analytics</a> 和 Cloudflare 的 <a target="_blank" rel="noopener" href="https://www.cloudflare.com/zh-cn/web-analytics/">Web analytics</a>，这两个都支持 http2，并且也足够用了。</p>
<h2 id="效果评估"><a href="#效果评估" class="headerlink" title="效果评估"></a>效果评估</h2><p>网页加载速度评估我这里主要用的是 <a target="_blank" rel="noopener" href="https://pagespeed.web.dev/">PageSpeed Insights</a>，和 Google 的 Lighthouse，一般评估网页的几个关键指标：</p>
<ul>
<li>FCP，First Contentful Paint，<strong>首次内容渲染</strong> FCP 衡量的是用户到网页后，<strong>浏览器呈现第一段 DOM 内容所用的时间</strong>。网页上的图片、非白色元素和 SVG 都会被视为 DOM 内容。一般 1.8s 以内都是可以接受的，Google 也会认为是 Good。</li>
<li>LCP，Largest Contentful Paint，<strong>最大内容渲染时间</strong>用于测量视口中最大的内容元素何时渲染到屏幕上。这粗略地估算出网页主要内容何时对用户可见。</li>
<li>FID，First Input Delay，衡量的是从用户首次与网页互动（比如点击链接）到浏览器能够实际开始处理事件处理脚本以响应该互动的时间。</li>
</ul>
<p>下图是各个指标的效果分布：</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_web_vitals.png/webp" alt="网页加载指标评估效果" srcset="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_web_vitals.png/webp 1544w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_web_vitals.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_web_vitals.png/webp800 800w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="1544" height="474"></p>
<p>还有一些其他指标，这里就先不展开聊了。Google 的 Lighthouse 给出的优化建议会比较详细一些，比如：</p>
<ul>
<li>压缩 CSS 和 JS 的大小；</li>
<li>移除用不到的 CSS 样式等；</li>
<li>最大限度的减少主线程延迟</li>
</ul>
<p>不过这些优化对整体效果提升效果不是很明显，并且需要花费比较大的时间，博客里就没有做这些优化。本博客优化完之后，性能的评分基本在 95 分以上了。不过这里的指标基于你当前地区，比如图片加载速度，国内 CDN 速度就很快，这里评估肯定也不错。</p>
<p>如果用了 Cloudflare 的 Web analytics，能看到实际访问博客的用户的各项指标，如下图：</p>
<p><img src="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_real_vitals.png/webp" alt="Cloudflare Web analytics 博客访问性能实时监测" srcset="https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_real_vitals.png/webp 2684w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_real_vitals.png/webp400 400w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_real_vitals.png/webp800 800w, https://slefboot-1251736664.file.myqcloud.com/20240103_hexo_blog_speed_real_vitals.png/webp1600 1600w" sizes="(min-width: 1150px) 723px, (min-width: 48em) calc((100vw - 120px) * 3 / 4 - 50px), (min-width: 35.5em) calc((100vw - 75px), calc(100vw - 40px)" width="2684" height="1764"></p>
<p>这里 LCP 有 5% 的 Poor，主要是因为博客中的图片，有些地区网络加载图片比较慢，这里也给出了明细，如下：</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#layout</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.pure-u-1</span><span class="selector-class">.pure-u-md-3-4</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.content_container</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.post</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.post-content</span>&gt;<span class="selector-tag">p</span>&gt;<span class="selector-tag">a</span><span class="selector-class">.fancybox</span>&gt;<span class="selector-tag">img</span></span><br><span class="line"><span class="selector-tag">slefboot-1251736664</span><span class="selector-class">.file</span><span class="selector-class">.myqcloud</span><span class="selector-class">.com</span>/<span class="number">20230727</span><span class="selector-tag">_chatgpt_hacking_jailbreaking_cover</span><span class="selector-class">.webp</span>/<span class="selector-tag">webp</span></span><br><span class="line"><span class="number">5</span>,<span class="number">485ms</span></span><br><span class="line"><span class="selector-id">#layout</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.pure-u-1</span><span class="selector-class">.pure-u-md-3-4</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.content_container</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.post</span>&gt;<span class="selector-tag">div</span><span class="selector-class">.post-content</span>&gt;<span class="selector-tag">p</span>&gt;<span class="selector-tag">a</span><span class="selector-class">.fancybox</span>&gt;<span class="selector-tag">img</span></span><br><span class="line"><span class="selector-tag">slefboot-1251736664</span><span class="selector-class">.file</span><span class="selector-class">.myqcloud</span><span class="selector-class">.com</span>/<span class="number">20231228</span><span class="selector-tag">_black_hat_SEO_search</span><span class="selector-class">.png</span>/<span class="selector-tag">webp1600</span></span><br><span class="line"><span class="number">8</span>,<span class="number">311ms</span></span><br></pre></td></tr></tbody></table></figure>

<p>说明 CDN 加速也不是 100% 就能解决所有地区的访问，可能换个比较好的 CDN 会有提升吧，不过作为个人博客，也没有继续折腾了。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://web.dev/articles/vitals">Web Vitals</a><br><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/lighthouse/performance/render-blocking-resources?hl=en">Eliminate render-blocking resources</a><br><a target="_blank" rel="noopener" href="https://developers.google.com/speed/webp">An image format for the Web</a><br><a target="_blank" rel="noopener" href="https://ausi.github.io/respimagelint/">RespImageLint - Linter for Responsive Images</a><br><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/lighthouse/performance/uses-responsive-images/">Properly size images</a><br><a target="_blank" rel="noopener" href="https://developer.chrome.com/docs/lighthouse/performance/performance-scoring?hl=en">Lighthouse performance scoring</a></p>
</div><div class="article-footer-copyright"><p>本文由<b>selfboot</b> 发表于<a href="https://selfboot.cn" target="_blank">个人博客</a>，采用<a href="https://creativecommons.org/licenses/by-sa/3.0/cn/" target="_blank">署名-非商业性使用-相同方式共享 3.0 中国大陆许可协议。</a></p><p>本文章已自动同步在<b style="color:red">个人公众号</b>，欢迎去 <a href="https://selfboot.cn/aboutme.html" target="_blank">个人主页 </a> 扫码关注</p><p>非商业转载请注明作者及出处。商业转载请联系<a href="mailto:xuezaigds@gmail.com">作者本人</a></p><p>本文标题为：个人博客访问速度优化：CDN, 图片压缩, HTTP2</p><p>本文链接为：https://selfboot.cn/2024/01/03/hexo_blog_speed/</p></div><div class="post-donate"><div class="donate_bar center" id="donate_board"><a class="btn_donate" id="btn_donate" href="javascript:;" title="赞助"></a><div class="donate_txt"> ↑<br>内容不错，赞助一下<br></div></div><div class="donate_bar center hidden" id="donate_guide"><img src="https://slefboot-1251736664.file.myqcloud.com/weixin.jpg" title="微信打赏"><img src="https://slefboot-1251736664.file.myqcloud.com/zhifubao.jpg" title="支付宝打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><div class="addthis_sharing_toolbox"></div><div class="tags"><a href="/tags/%E6%96%B9%E6%B3%95/"><i class="fa fa-tag"></i>方法</a><a href="/tags/%E5%89%8D%E7%AB%AF/"><i class="fa fa-tag"></i>前端</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://selfboot.cn/2024/01/03/hexo_blog_speed/';
    this.page.identifier = '2024/01/03/hexo_blog_speed/';
    this.page.title = '个人博客访问速度优化：CDN, 图片压缩, HTTP2';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//xuelangZF.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//xuelangZF.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://xuelangZF.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="https://www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://selfboot.cn"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"></i><span>分类</span></div><ul><li><a href="/categories/程序设计/">程序设计</a> (23)</li><li><a href="/categories/工具介绍/">工具介绍</a> (13)</li><li><a href="/categories/数据结构与算法/">数据结构与算法</a> (13)</li><li><a href="/categories/计算机基础/">计算机基础</a> (8)</li><li><a href="/categories/社会百态/">社会百态</a> (11)</li><li><a href="/categories/计算机网络/">计算机网络</a> (4)</li><li><a href="/categories/项目实践/">项目实践</a> (10)</li><li><a href="/categories/源码剖析/">源码剖析</a> (15)</li><li><a href="/categories/法律普及/">法律普及</a> (26)</li><li><a href="/categories/金融/">金融</a> (1)</li><li><a href="/categories/人工智能/">人工智能</a> (31)</li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"></i><span>标签</span></div><div class="tagcloud"><a href="/tags/Python/" style="font-size: 15.00px;">Python</a> <a href="/tags/教程/" style="font-size: 15.00px;">教程</a> <a href="/tags/总结/" style="font-size: 15.00px;">总结</a> <a href="/tags/方法/" style="font-size: 15.00px;">方法</a> <a href="/tags/Google/" style="font-size: 15.00px;">Google</a> <a href="/tags/思考/" style="font-size: 15.00px;">思考</a> <a href="/tags/前端/" style="font-size: 15.00px;">前端</a> <a href="/tags/Django/" style="font-size: 15.00px;">Django</a> <a href="/tags/DNS/" style="font-size: 15.00px;">DNS</a> <a href="/tags/见闻/" style="font-size: 15.00px;">见闻</a> <a href="/tags/Protocol/" style="font-size: 15.00px;">Protocol</a> <a href="/tags/C/" style="font-size: 15.00px;">C++</a> <a href="/tags/Flask/" style="font-size: 15.00px;">Flask</a> <a href="/tags/Thread/" style="font-size: 15.00px;">Thread</a> <a href="/tags/法律/" style="font-size: 15.00px;">法律</a> <a href="/tags/ChatGPT/" style="font-size: 15.00px;">ChatGPT</a> <a href="/tags/Prompt/" style="font-size: 15.00px;">Prompt</a> <a href="/tags/Plugin/" style="font-size: 15.00px;">Plugin</a> <a href="/tags/Leetcode/" style="font-size: 15.00px;">Leetcode</a> <a href="/tags/Redis/" style="font-size: 15.00px;">Redis</a> <a href="/tags/Debug/" style="font-size: 15.00px;">Debug</a> <a href="/tags/Issue/" style="font-size: 15.00px;">Issue</a> <a href="/tags/eBPF/" style="font-size: 15.00px;">eBPF</a> <a href="/tags/婚姻家庭/" style="font-size: 15.00px;">婚姻家庭</a> <a href="/tags/Go/" style="font-size: 15.00px;">Go</a> <a href="/tags/刑事/" style="font-size: 15.00px;">刑事</a> <a href="/tags/劳动纠纷/" style="font-size: 15.00px;">劳动纠纷</a> <a href="/tags/数学/" style="font-size: 15.00px;">数学</a> <a href="/tags/Gemini/" style="font-size: 15.00px;">Gemini</a> <a href="/tags/google/" style="font-size: 15.00px;">google</a> <a href="/tags/LLM/" style="font-size: 15.00px;">LLM</a> <a href="/tags/LevelDB/" style="font-size: 15.00px;">LevelDB</a></div></div><!-- Debug: page.path = 2024/01/03/hexo_blog_speed/ --><div class="widget"><div class="widget-title"><i class="fa fa-file-o"></i><span>最近文章</span></div><ul><li><a href="/2024/09/24/leveldb_source_skiplist_time_analysis/" title="LevelDB 源码阅读：如何分析跳表的时间复杂度？">LevelDB 源码阅读：如何分析跳表的时间复杂度？</a></li><li><a href="/2024/09/18/leveldb_source_skiplist_test/" title="LevelDB 源码阅读：如何正确测试跳表的并行读写？">LevelDB 源码阅读：如何正确测试跳表的并行读写？</a></li><li><a href="/2024/09/13/gpto1_hands_on/" title="实际例子上手体验 OpenAI o1-preview，比预期差一点？">实际例子上手体验 OpenAI o1-preview，比预期差一点？</a></li><li><a href="/2024/09/09/leveldb_source_skiplist/" title="LevelDB 源码阅读：跳表的原理、实现以及可视化">LevelDB 源码阅读：跳表的原理、实现以及可视化</a></li><li><a href="/2024/09/05/claude35_prompt/" title="Claude3.5 系统提示词解密：不道歉、脸盲、幻觉...">Claude3.5 系统提示词解密：不道歉、脸盲、幻觉...</a></li><li><a href="/2024/08/29/leveldb_source_utils/" title="LevelDB 源码阅读：内存分配器、随机数生成、CRC32、整数编解码">LevelDB 源码阅读：内存分配器、随机数生成、CRC32、整数编解码</a></li><li><a href="/2024/08/14/leveldb_source_wal_log/" title="LevelDB 源码阅读：读写 WAL 日志保证持久性">LevelDB 源码阅读：读写 WAL 日志保证持久性</a></li><li><a href="/2024/08/13/leveldb_source_unstand_c++/" title="LevelDB 源码阅读：理解其中的 C++ 高级技巧">LevelDB 源码阅读：理解其中的 C++ 高级技巧</a></li><li><a href="/2024/08/08/leveldb_source_bloom_filter/" title="LevelDB 源码阅读：布隆过滤器原理、实现、测试与可视化">LevelDB 源码阅读：布隆过滤器原理、实现、测试与可视化</a></li><li><a href="/2024/08/06/leveldb_source_prepare/" title="LevelDB 源码阅读：准备开发环境">LevelDB 源码阅读：准备开发环境</a></li></ul></div><!-- Debug: Current Language = zh-CN, Filtered Posts Count = 10 --><div class="widget" id="toc"><div class="widget-title"><i class="fa fa-list-ul"></i><span> 文章目录</span></div><ul class="dsq-widget-list"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CDN-%E5%8A%A0%E9%80%9F"><span class="toc-number">1.</span> <span class="toc-text">CDN 加速</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSS-%E5%92%8C-JS-%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">CSS 和 JS 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87-CDN"><span class="toc-number">1.2.</span> <span class="toc-text">图片 CDN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CDN-%E9%98%B2%E7%9B%97%E5%88%B7"><span class="toc-number">1.3.</span> <span class="toc-text">CDN 防盗刷</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">图片优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E4%BC%98%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">图片格式优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E9%80%82%E5%BA%94%E5%9B%BE%E7%89%87"><span class="toc-number">2.2.</span> <span class="toc-text">自适应图片</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-2"><span class="toc-number">3.</span> <span class="toc-text">HTTP 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E8%AF%84%E4%BC%B0"><span class="toc-number">4.</span> <span class="toc-text">效果评估</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="toc-number">5.</span> <span class="toc-text">参考文档</span></a></li></ol></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Just For Fun.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/selfboot/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/selfboot"> SelfBoot.</a><p><span id="busuanzi_container_site_pv"></span>本站总访问量 <span id="busuanzi_value_site_pv"></span> 次，<span id="busuanzi_container_site_uv"></span>本站访客数: <span id="busuanzi_value_site_uv"></span> 人次</p></div></div></div><link rel="stylesheet" type="text/css" href="/css/donate.css"><link rel="stylesheet" type="text/css" href="/css/copyright.css"><a class="show" id="rocket" href="#top" aria-label="Back to top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script><script type="text/javascript" src="/js/jquery.fancybox.min.js" defer=""></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" defer=""></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.min.css"><script type="text/javascript" src="/js/toc.js?v=1.0.0"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>